<!-- partials/_category_filters_dropdown.html -->
<!-- Este es el nuevo menú desplegable para tus categorías -->

<div x-data="{ open: false }" @click.away="open = false" class="relative">
    <!-- Botón principal del dropdown -->
    <button @click="open = !open" class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-white/20 hover:bg-white/30 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-pink-500 transition-all">
        <span>Categorías</span>
        <svg class="w-5 h-5 ml-2 -mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
    </button>

    <!-- Panel del dropdown -->
    <div x-show="open" 
         x-transition:enter="transition ease-out duration-100"
         x-transition:enter-start="transform opacity-0 scale-95"
         x-transition:enter-end="transform opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-75"
         x-transition:leave-start="transform opacity-100 scale-100"
         x-transition:leave-end="transform opacity-0 scale-95"
         class="origin-top-center absolute left-1/2 -translate-x-1/2 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50"
         style="display: none;">
        <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
            <a href="{% url 'catalogo_publico' %}" class="filter-btn block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-gray-900 font-semibold" role="menuitem" data-category="all">
                Mostrar Todos
            </a>
            <div class="border-t border-gray-100 my-1"></div>
            
            <!-- === LÓGICA DE SUBCATEGORÍAS === -->
            {% for cat in categorias %}
                <div class="px-4 py-2">
                    <!-- Categoría Padre -->
                    <a href="{% url 'catalogo_publico' %}?categoria={{ cat.slug }}" class="js-category-link text-sm font-bold text-gray-800 hover:text-[--brand-accent] transition-colors">
                        {{ cat.nombre }}
                    </a>
                    
                    <!-- Subcategorías -->
                    {% if cat.children.all %}
                        <div class="mt-2 pl-3 border-l-2 border-gray-200 space-y-1">
                            {% for subcat in cat.children.all %}
                            <a href="{% url 'catalogo_publico' %}?categoria={{ subcat.slug }}" class="js-category-link block text-sm text-gray-600 hover:text-[--brand-accent] transition-colors">
                                {{ subcat.nombre }}
                            </a>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            <!-- === FIN DE LA LÓGICA === -->
            
            <div class="border-t border-gray-100 my-1"></div>
            <a href="{% url 'catalogo_publico' %}?categoria=nueva_coleccion" data-category="nueva_coleccion" class="filter-btn block px-4 py-2 text-sm text-yellow-600 hover:bg-gray-100 hover:text-gray-900 font-semibold" role="menuitem">
                ★ Nueva Colección
            </a>
        </div>
    </div>
</div>

<!-- Menú desplegable de categorías con subcategorías en lista vertical -->
<div class="relative group">
  <button class="bg-pink-200 text-pink-700 font-semibold py-2 px-4 rounded-full flex items-center gap-2 focus:outline-none">
    Categorías <i class="fas fa-chevron-down"></i>
  </button>
  <div class="absolute left-0 mt-2 w-64 bg-white rounded-lg shadow-lg py-3 z-50 hidden group-hover:block">
    <span class="block px-4 py-2 font-bold text-gray-800">Categorías</span>
    <ul>
      {% for cat in categorias %}
        <li>
          <a href="{% url 'catalogo_publico' %}?categoria={{ cat.slug }}" class="js-category-link block px-4 py-2 text-pink-700 font-semibold hover:bg-pink-50 transition-all">
            {{ cat.nombre }}
          </a>
          {% if cat.children.all %}
            <ul class="ml-6 mt-1 mb-2 border-l-2 border-pink-100 pl-3">
              {% for subcat in cat.children.all %}
                <li>
                  <a href="{% url 'catalogo_publico' %}?categoria={{ subcat.slug }}" class="js-category-link block px-2 py-1 text-gray-700 hover:text-pink-600 hover:bg-pink-50 rounded transition-all">
                    {{ subcat.nombre }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Sidebar de categorías -->
<aside class="w-64 bg-white shadow-md rounded-lg p-4">
  <h3 class="font-bold text-lg mb-4">Categorías</h3>
  <ul>
    {% for cat in categorias %}
      <li class="mb-2 group relative">
        <button class="w-full text-left font-semibold hover:text-pink-600 focus:outline-none">
          {{ cat.nombre }}
        </button>
        {% if cat.children.all %}
          <ul class="ml-4 mt-1 hidden group-hover:block absolute bg-white border rounded shadow z-10">
            {% for subcat in cat.children.all %}
              <li>
                <a href="{% url 'catalogo_publico' %}?categoria={{ subcat.slug }}" class="block px-2 py-1 hover:bg-pink-50">
                  {{ subcat.nombre }}
                </a>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</aside>
